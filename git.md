# Краткая инструкция по работе с git

## Система контроля версий

**Cистема контроля версий (VCS)** — программное обеспечение для облегчения работы с изменяющейся информацией.

+ _**Полная история изменений каждого файла за длительный период**_. Это касается всех изменений, внесенных огромным количеством людей за долгие годы. Изменением считается создание и удаление файлов, а также редактирование их содержимого. Различные инструменты VCS отличаются тем, насколько хорошо они обрабатывают операции переименования и перемещения файлов. В историю также должны входить сведения об авторе, дата и комментарий с описанием цели каждого изменения. Наличие полной истории позволяет возвращаться к предыдущим версиям, чтобы проводить анализ основных причин возникновения ошибок и устранять проблемы в старых версиях программного обеспечения.

+ _**Ветвление и слияние**_. Создание «веток» позволяет иметь несколько независимых друг от друга направлений разработки, а также выполнять их слияние, чтобы разработчики могли проверить, что изменения, внесенные в каждую из веток, не конфликтуют друг с другом. Многие команды разработчиков программного обеспечения создают отдельные ветки для каждой функциональной возможности, для каждого релиза либо и для того, и для другого.

+ _**Отслеживаемость**_. Возможность отслеживать каждое изменение, внесенное в программное обеспечение, и связывать его с ПО для управления проектами и отслеживания ошибок. История с комментариями во время чтения кода помогает понять, что этот код делает и почему действие реализовано именно таким образом. Благодаря этому разработчики могут вносить корректные и совместимые изменения в соответствии с долгосрочным планом разработки системы.


## Подготовка к работе

1. Скачать и установить VS Code https://code.visualstudio.com/docs/?dv=win

1. Скачать и установить Git https://git-scm.com/download/win

1. Проверить, работает ли git с помощью команды `git --version`

1. Добавить имя и email пользователя с помощью команд
```
git config --global user.email "email@mail.com"
git config --global user.name "User Name"
```


## Команды

### `git help`
Краткий справочник команд git. Получить подробное описание с примерами использования можно командой `git help <command>`, например `git help clone`.

Подробная информация содержит блоки:
- **NAME** -- название команды
- **SYNOPSIS** -- список опций и аргументов, их порядок при вызове команды
- **DESCRIPTION** -- описание команды
- **OPTIONS** -- список опций и подробное описание по каждой их них.
- **EXAMPLES** -- примеры использования команды
- указание версии и дата обновления справки

### `git init`
Эта команда создаёт в текущем каталоге новый подкаталог с именем `.git`, содержащий все необходимые файлы репозитория — структуру Git репозитория. На этом этапе ваш проект ещё не находится под версионным контролем.
Если вы хотите добавить под версионный контроль существующие файлы (в отличие от пустого каталога), вам стоит добавить их в индекс и осуществить первый коммит изменений. Добиться этого вы сможете запустив команду `git add` несколько раз, указав индексируемые файлы, а затем выполнив `git commit`.

### `git add`
Команда `git add` добавляет содержимое рабочего каталога в индекс (staging area) для последующего коммита. По умолчанию `git commit` использует лишь этот индекс, так что вы можете использовать `git add` для сборки слепка вашего следующего коммита.

### `git status`
Команда git status показывает состояния файлов в рабочем каталоге и индексе: какие файлы изменены, но не добавлены в индекс; какие ожидают коммита в индексе. Вдобавок к этому выводятся подсказки о том, как изменить состояние файлов.

### `git commit`
Команда `git diff` используется для вычисления разницы между любыми двумя Git деревьями. Это может быть разница между вашей рабочей копией и индексом (собственно `git diff`), разница между индексом и последним коммитом (`git diff --staged`), или между любыми двумя коммитами (`git diff master branchB`).

### `git log`
После того, как вы создали несколько коммитов или же клонировали репозиторий с уже существующей историей коммитов, вероятно вам понадобится возможность посмотреть что было сделано — историю коммитов. Одним из основных и наиболее мощных инструментов для этого является команда `git log`.

### `git checkout`
После того как вы нашли ссылку на нужный коммит в истории, для перехода к нему можно использовать команду `git checkout`. Команда `git checkout` — это простой способ переключиться в указанную версию.

### `git checkout master`
переключение на ветку master, в последний коммит

### `git diff`
Показывает различия между проиндексированной и последней зафиксированной версиями файлов

### `git diff [первая ветка]...[вторая ветка]`
Показывает разницу между содержанием коммитов двух веток

### `git show [коммит]`
Выводит информацию и показывает изменения в выбранном коммите

### `git branch`
Список именованных веток коммитов с указанием выбранной ветки

### `git branch [имя ветки]`
Создаёт новую ветку

### `git merge [имя ветки]`
Вносит изменения указанной ветки в текущую ветку

### `git branch -d [имя ветки]`
Удаляет выбранную ветку


## Работа с удаленным репозиторием

Удаленный (remote) репозиторий – это репозиторий, расположенный на другом компьютере в сети, например, специализированном хранилище (сервере).
Удаленный репозиторий используется для централизации работы группы людей в рамках одного или нескольких проектов, обеспечивает совместный доступ на чтение и запись изменений. В сети может быть несколько удаленных репозиторием, поэтому каждый репозиторий имеет свой собственный уникальный адрес.
Так же удаленный репозиторий обеспечивает разные уровни доступа, например, какая-то группа людей не имеет возможности записывать изменения в ветку master.

Есть два наиболее часто используемых сценария подключения к удаленному репозиторию.

### Клонирование проекта

Чтобы начать работу с уже существующим репозиторием достаточно выполнить следующие команды в терминале:
```
cd ~/my_work
git clone https://domain.com/work/project.git
```

Первая команда переводит в какую-то рабочую директорию, где мы хотим разместить папку с проектом, а вторая команда `git clone` выполнил следующие действия:
- создаст папку `project` внутри папки `my_work` - папка будет называться точно так же, как называется проект
- сольет полную копию проекта `project.git` в папку `project`
- и включит ветку по-умолчанию (обычно `master`)

Команда `git clone` - составная, и ее результат был бы идентичин выполнению следующих команд (при условии что в папке `project` нет других файлов):
```
git init
git remote add origin https://domain.com/work/project.git
git pull
```

### Подключение удаленного репозитория в уже существующий проект

В ходе работы с локальным репозиторием возникает необходимость поделиться своими наработками или добавить наработки коллег.
Для этого в ваш локальный репозиторий нужно добавить возможность чтения/записи в удаленный репозиторий.

#### Добавление связи с удаленным репозиторием

Для настройки работы с удаленными репозиториями используется команда `git remote`. Для начала проверим какие вообще удаленные репозитории настроены в проекте:

```
git remote -v
```

Если в вашем проекте нет связей с удаленными репозиториями, то на экране ничего не отобразится, иначе вы увидите, например, такой результат:
```
origin	https://domain.com:my_work/project.git (fetch)
origin	https://domain.com:my_work/project.git (push)
```

Здесь мы видим, что к нашему проекту подключен один удаленный репозиторий, `origin` - название по-умолчанию, это лишь псевдоним (name) для репозитория `https://domain.com:my_work/project.git`. Почему две строчки, если репозиторий всего один? Git предоставляет работу в двух направлениях - читать и писать в репозиторий,
поэтому для каждой из операций указывается адрес репозитория.

К командам `fetch`, `pull` и `push` вернется чуть ниже. Для добавления связи с удаленным репозиторием нужно выполнить команду:
```
git remote add <name> <url>
# например:
git remote add origin https://domain.com:my_work/project.git
```
Если все прошло успешно, то теперь мы сможем читать и писать в удаленный репозиторий `origin`, который находится по адресу https://domain.com:my_work/project.git.

В проект можно добавить связи с несколькими удаленными репозиториями - так же через команду `git remote add`, главное чтобы у них были уникальные имена.
В случае наличия связей с несколькими репозиториями, один из них (обычно добавленный первым) будет считаться репозиторием по-умоланию.

### Работа с репозиториями в сервисе Github

Сервис Github (github.com) предоставляет массу дополнительных возможностей (в том числе и платных) при работе с репозиториями, для одиноек и команд, и целых комьюнити:
- приватные (private) репозитории
- статистика и визуализация истории
- online-редактор и просмотр в режиме сравнения
- создание копий (forks) публичных репозиториев
- передача изменений из репозитория в репозиторий через pull request (предложение на слияние)
- просмотр и комментирвоание кода перед слиянием
- встроенный bug tracker - раздел Issues, где можно указать об ошибке в ппрграмме или запросить помощь
- документирвоание своего проекта
- инструменты CI/CD - для автоматизации процессов
- настройка и разграничение прав доступа к репозиториям
- указывать protected branches - защищенный от удаления ветки
- доступ в репозиторий по HTTPS и через SSH
- и многое другое

#### Организация доступа к удаленным репозиторим через SSH

SSH  (сокрашение от **S**ecure **SH**ell) – терминальная утилита, для подлкючения к удаленным серверам в безопасном (зашифрованном) режиме. SSH как и HTTPS работает на базе TCP-протокола, что подразумевает клиент-серверный обмен. Для идентификации и ауентификации на сервере испульзуется один из двух режимов:
- либо по паре логин-пароль, зарегистрированных на сервере
- либо логину и ключу

Ключ состоит из двух частей - **приватной** и **публичной** – пары текстовых файлов, созданых криптографической программой, например, по алгоритму RSA.

Публичный ключ размещается на сервере (администратором сервера), на который хотим получить доступ. Этот файл безопасно передавать кому угодно, т.к. он работает только в паре с приваным ключом. Приватный ключ всегда хранится у клиента, и не должен быть скомпроментирован и в этом плане ничем не отличается от пароля. Но в отличие от пароля авторизация по ключу может быть автоматизирована и после разовой настройки не будет требовать дополительного ввода с клавиатуры паролей.

#### Github и ssh-ключи

На Github есть исчерпывающая !(инструкция)[https://docs.github.com/en/authentication/connecting-to-github-with-ssh] по работе с ключами.

В первую очередь нужно понимать, что любое действие с удаленным репозиторием требует подтверждений прав на доступ и выполнение команд. Чтобы при каждой операции `git pull` и `git push` не вводить логин и пароль можно использовать !(визуальные оболочки)[https://git-scm.com/downloads/guis] (GUI), предоставляющие возможность запомнить введенные логин и пароль, которые GUI будет автоматически подставлять. Но это не всегда выполнимо, особенно когда речь идет о межсерверном взаимодействии, например, в процессе настройки CI/CD (Continuous Integration/Continuous Deployment) – непрерывной доставке кода. Для этого достаточно научить терминал выполнять git команды при работе с удаленным репозиторием через SSH.

После установки ssh (в операционных системах MacOS и Linux предоставляется по-умолчанию), генерации и регистрации ключей

При использовании команды `git clone`:
```
git clone ssh@github.com:my_work/project.git
```

При ручном добавлении remote в проект:
```
# вместо
git add remote origin https://domain.com:my_work/project.git
# указать
git add remote origin ssh://git@github.com:my_work/project.git
````

Или изменить в ходе работы:
```
git remote set-url origin git@github.com:my_work/my_work.git
```

#### Проверка авторизации в Github по ключу

Если вы сделали всё правильно, то выполнив команду `ssh git@github.com` вы увидите, что Github узнал вас:

```
$ ssh git@github.com
<...>
Hi moodtraffic! You've successfully authenticated, but GitHub does not provide shell access.
Connection to github.com closed.
```
